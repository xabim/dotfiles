#!/bin/zsh
{{- if eq .chezmoi.os "darwin" }}

# Enhanced macOS configuration - Additional settings from legacy config
# This supplements the main run_once_after_configure-macos.sh.tmpl

set -eufo pipefail

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üîß Applying enhanced macOS settings...${NC}"

###############################################################################
# üéõÔ∏è Enhanced Mission Control & Hot Corners
###############################################################################

echo -e "${YELLOW}Configuring Hot Corners...${NC}"
# Hot corners
# Possible values:
#  0: no-op
#  2: Mission Control
#  3: Show application windows
#  4: Desktop
#  5: Start screen saver
#  6: Disable screen saver
#  10: Put display to sleep
#  11: Launchpad
#  12: Notification Center

# Top left screen corner ‚Üí Show application windows
defaults write com.apple.dock wvous-tl-corner -int 3
defaults write com.apple.dock wvous-tl-modifier -int 0

# Top right screen corner ‚Üí Mission Control
defaults write com.apple.dock wvous-tr-corner -int 2
defaults write com.apple.dock wvous-tr-modifier -int 0

# Bottom left screen corner ‚Üí Notification Center
defaults write com.apple.dock wvous-bl-corner -int 12
defaults write com.apple.dock wvous-bl-modifier -int 0

# Bottom right screen corner ‚Üí Desktop
defaults write com.apple.dock wvous-br-corner -int 4
defaults write com.apple.dock wvous-br-modifier -int 0

# Don't automatically rearrange Spaces based on most recent use
defaults write com.apple.dock mru-spaces -bool false

###############################################################################
# ‚å®Ô∏è Enhanced Keyboard Settings
###############################################################################

echo -e "${YELLOW}Configuring Keyboard...${NC}"

# Disable automatic modifications of entered text
defaults write -g NSAutomaticCapitalizationEnabled -bool false
defaults write -g NSAutomaticDashSubstitutionEnabled -bool false
defaults write -g NSAutomaticPeriodSubstitutionEnabled -bool false
defaults write -g NSAutomaticQuoteSubstitutionEnabled -bool false
defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false

# Enable full keyboard access for all controls
# (e.g. enable Tab in modal dialogs)
defaults write -g AppleKeyboardUIMode -int 3

###############################################################################
# üñ±Ô∏è Enhanced Mouse Settings
###############################################################################

echo -e "${YELLOW}Configuring Mouse...${NC}"
# Increase mouse tracking speed
defaults write -g com.apple.mouse.scaling -float 2.5

# Disable secondary button on click
defaults write com.apple.driver.AppleBluetoothMultitouch.mouse MouseButtonMode OneButton

###############################################################################
# üíª Enhanced Trackpad Settings
###############################################################################

echo -e "${YELLOW}Configuring Trackpad...${NC}"
# Tracking Speed: from 0 to 3
defaults write -g com.apple.trackpad.scaling -float 3

# Enable tap to click for the current user and the login screen
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
defaults write com.apple.AppleMultitouchTrackpad Clicking -int 1
defaults -currentHost write -g com.apple.mouse.tapBehavior -int 1
defaults write -g com.apple.mouse.tapBehavior -int 1

# Trackpad: map two fingers tap to right-click
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadCornerSecondaryClick -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRightClick -bool true
defaults -currentHost write -g com.apple.trackpad.trackpadCornerClickBehavior -int 1
defaults -currentHost write -g com.apple.trackpad.enableSecondaryClick -bool true

###############################################################################
# üìÇ Enhanced Finder Settings
###############################################################################

echo -e "${YELLOW}Configuring Additional Finder Settings...${NC}"
# Disable all animations
defaults write com.apple.finder DisableAllAnimations -bool true

# Set default view style to column view
defaults write com.apple.finder FXPreferredViewStyle -string "clmv"

# New Finder windows open at home directory
defaults write com.apple.finder NewWindowTarget -string "PfDe"
defaults write com.apple.finder NewWindowTargetPath -string "file://$HOME/"

# Don't open new tabs when opening new Finder window
defaults write com.apple.finder FinderSpawnTab -bool false

# Sort folders first
defaults write com.apple.finder _FXSortFoldersFirst -bool true

# Enable text selection in Quick Look
defaults write com.apple.finder QLEnableTextSelection -bool true

###############################################################################
# üîí Enhanced Security Settings
###############################################################################

echo -e "${YELLOW}Configuring Security...${NC}"
# Require password immediately after sleep or screen saver begins
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

###############################################################################
# üåê Enhanced Network Settings
###############################################################################

echo -e "${YELLOW}Configuring Network...${NC}"
# Enable AirDrop over Ethernet and on unsupported Macs running Lion
defaults write com.apple.NetworkBrowser BrowseAllInterfaces -bool true

###############################################################################
# üíæ Enhanced Storage Settings
###############################################################################

echo -e "${YELLOW}Configuring Storage...${NC}"
# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

###############################################################################
# üé® Enhanced UI Settings
###############################################################################

echo -e "${YELLOW}Configuring UI...${NC}"
# Always show scrollbars
defaults write -g AppleShowScrollBars -string "Always"

# Increase window resize speed for Cocoa applications
defaults write -g NSWindowResizeTime -float 0.001

# Save to disk (not to iCloud) by default
defaults write -g NSDocumentSaveNewDocumentsToCloud -bool false

# Disable Resume system-wide
defaults write com.apple.systempreferences NSQuitAlwaysKeepsWindows -bool false

# Disable the "Are you sure you want to open this application?" dialog
defaults write com.apple.LaunchServices LSQuarantine -bool false

echo -e "${GREEN}‚úÖ Enhanced macOS configuration applied!${NC}"
echo -e "${YELLOW}Note: Some changes require a restart to take effect.${NC}"

{{- end }}