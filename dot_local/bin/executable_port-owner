#!/usr/bin/env zsh

# Find process listening on a specific port

set -euo pipefail

if [[ $# -ne 1 ]]; then
  echo "Usage: port-owner <port>" >&2
  echo "Example: port-owner 3000" >&2
  exit 1
fi

port="$1"

# Validate port number
if ! [[ "$port" =~ ^[0-9]+$ ]] || [[ "$port" -lt 1 ]] || [[ "$port" -gt 65535 ]]; then
  echo "Error: Invalid port number '$port'" >&2
  exit 1
fi

echo "Processes listening on port $port:"
lsof -n -i4TCP:"$port" | grep LISTEN || echo "No processes found listening on port $port"